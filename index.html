<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Sky VS ‚Äî Players</title>
<link rel="icon" href="data:," />
<style>
  :root{
    --accent:#4da6ff;
    --accent-2:#1ec8ff;
    --dark:#0f1724;
    --card:#1a1f33;
    --muted:#666;
  }
  *{box-sizing:border-box;font-family:Inter,system-ui,Arial,sans-serif}
  html,body{height:100%;margin:0;background:#fff;color:#111}
  /* Loading screen */
  #loadingScreen{
    position:fixed;inset:0;background:linear-gradient(180deg,#071129 0%, #0d1726 60%);display:flex;
    align-items:center;justify-content:center;flex-direction:column;z-index:9999;
  }
  #loadingText{font-size:3rem;color:var(--accent);font-weight:800;letter-spacing:2px;
    text-shadow:0 6px 20px rgba(30,200,255,0.08);animation:glow 1.5s ease-in-out infinite alternate;}
  @keyframes glow{from{filter:drop-shadow(0 0 8px rgba(77,166,255,0.25))} to{filter:drop-shadow(0 0 28px rgba(30,200,255,0.45))}}
  .loading-bar{width:60%;max-width:520px;height:12px;background:rgba(255,255,255,0.08);border-radius:8px;margin-top:18px;overflow:hidden}
  .loading-fill{height:100%;width:0;background:linear-gradient(90deg,var(--accent),var(--accent-2));animation:load 3.6s linear forwards;border-radius:8px}
  @keyframes load{to{width:100%}}
  /* small shimmer */
  .loading-sub{margin-top:12px;color:#bcd9ff;opacity:.85;font-size:.92rem}

  /* Hide screens initially (JS controls) */
  #warningScreen,#infoScreen,#dashboard,#profileModal,#playerModal,#loginScreen{display:none}

  /* Warning & info screens */
  .centerScreen{position:fixed;inset:0;background:linear-gradient(180deg,#f8fafc,#ffffff);display:flex;align-items:center;justify-content:center;z-index:900;padding:24px}
  .panel{width:100%;max-width:760px;background:#fff;border-radius:12px;box-shadow:0 10px 30px rgba(24,39,75,0.08);padding:28px;text-align:left}
  .panel h2{color:#ff9800;margin:0 0 10px;font-size:1.6rem}
  .panel p{color:#222;line-height:1.55;margin:8px 0}
  .panel .muted{color:var(--muted);font-size:.95rem;margin-top:12px}
  .btn{background:var(--accent);color:#fff;border:none;padding:10px 16px;border-radius:10px;cursor:pointer;font-weight:600}
  .btn:hover{background:var(--accent-2)}

  /* Topbar */
  header{height:64px;display:flex;align-items:center;justify-content:space-between;padding:0 20px;background:transparent;position:relative;z-index:10}
  .brand{display:flex;align-items:center;gap:12px}
  .brand .logo{width:44px;height:44;border-radius:10px;background:linear-gradient(135deg,var(--accent),var(--accent-2));display:flex;align-items:center;justify-content:center;color:#fff;font-weight:800}
  .brand h1{font-size:1.1rem;margin:0;color:#0b1220}
  .top-actions{display:flex;align-items:center;gap:12px}

  /* Dashboard main */
  #mainWrap{padding:28px;max-width:1100px;margin:0 auto}
  h2.pageTitle{font-size:1.6rem;margin:8px 0 18px}
  .players{display:flex;flex-wrap:wrap;gap:16px}
  .player-card{width:200px;background:var(--card);color:#fff;padding:14px;border-radius:12px;box-shadow:0 8px 22px rgba(17,24,39,0.18);cursor:pointer;transition:transform .18s,box-shadow .18s}
  .player-card:hover{transform:translateY(-6px);box-shadow:0 18px 40px rgba(30,100,255,0.12)}
  .player-name{font-weight:700;font-size:1.05rem}
  .player-sub{font-size:.9rem;color:#d2eaff;margin-top:8px}
  .player-meta{margin-top:10px;font-size:.82rem;color:#bcd9ff}

  /* bubble background */
  .bubbles{position:fixed;inset:0;pointer-events:none;z-index:-1}
  .bubble{position:absolute;border-radius:50%;background:linear-gradient(180deg,rgba(77,166,255,0.18),rgba(30,200,255,0.08));filter:blur(6px);opacity:.9}

  /* Profile button */
  .profileBtn{background:#fff;border:1px solid rgba(14,21,35,0.06);padding:8px 12px;border-radius:10px;cursor:pointer;display:flex;align-items:center;gap:8px}
  .profileBtn .dot{width:10px;height:10px;border-radius:50%;background:var(--accent)}

  /* Modals */
  .modal{position:fixed;inset:0;background:rgba(8,12,18,0.45);display:flex;align-items:center;justify-content:center;z-index:1000}
  .modal .card{background:#fff;padding:20px;border-radius:12px;width:360px;box-shadow:0 18px 40px rgba(12,18,40,0.18)}
  .modal h3{margin:0 0 10px}
  .field{display:flex;flex-direction:column;margin:8px 0}
  .field input{padding:10px;border-radius:8px;border:1px solid #e6eefc}
  .small{font-size:.85rem;color:var(--muted);margin-top:6px}

  /* toast */
  #toast{position:fixed;right:20px;bottom:20px;background:#0b1726;color:#fff;padding:10px 14px;border-radius:10px;box-shadow:0 10px 30px rgba(0,0,0,0.2);display:none;z-index:1200}

  /* login screen */
  #loginScreen{position:fixed;inset:0;background:linear-gradient(180deg,#071129 0%, #0d1726 60%);display:flex;align-items:center;justify-content:center;z-index:99999}
  #loginBox{background:#fff;padding:26px;border-radius:12px;width:360px;box-shadow:0 18px 40px rgba(0,0,0,0.25);text-align:center}
  #loginBox h2{margin:0 0 10px;color:#0b1220}
  #loginBox .small{color:#455;text-align:left;margin-top:8px}

  /* small responsive */
  @media (max-width:640px){
    .player-card{width:48%}
    .loading-bar{width:80%}
    #loginBox{width:92%}
  }
</style>
</head>
<body>

<!-- Loading -->
<div id="loadingScreen">
  <div id="loadingText">Sky VS</div>
  <div class="loading-bar"><div class="loading-fill"></div></div>
  <div class="loading-sub">Loading players, assets and fun...</div>
</div>

<!-- Warning Screen -->
<div id="warningScreen" class="centerScreen">
  <div class="panel">
    <h2>‚ö†Ô∏è Important Warning</h2>
    <p>Hi player! Here you can VS with pro players on FC and play together and also make friends.</p>
    <p>This is <strong>not an official</strong> platform ‚Äî it's a fun project made by players. Use respectfully and at your own risk.</p>
    <p class="muted">We do not share private info. If you use the Add/Upload features, do not add sensitive data. By pressing Continue you acknowledge that you've read this warning.</p>
    <div style="margin-top:18px;text-align:right">
      <button class="btn" onclick="goToInfo()">Continue</button>
    </div>
  </div>
</div>

<!-- Info Screen -->
<div id="infoScreen" class="centerScreen">
  <div class="panel">
    <h2>üìß Info</h2>
    <p>You will receive relevant emails if you VS with other players (if email is provided). In future updates we'll add in-app messaging.</p>
    <p class="muted">Click OK to open the dashboard.</p>
    <div style="margin-top:18px;text-align:right">
      <button class="btn" onclick="openDashboard()">OK</button>
    </div>
  </div>
</div>

<!-- Login (one-time) -->
<div id="loginScreen">
  <div id="loginBox">
    <div style="display:flex;align-items:center;justify-content:center;margin-bottom:12px">
      <div style="width:52px;height:52px;border-radius:10px;background:linear-gradient(135deg,var(--accent),var(--accent-2));display:flex;align-items:center;justify-content:center;color:#fff;font-weight:800">SV</div>
    </div>
    <h2>Sign Up / Login</h2>
    <p style="color:#516;opacity:.85">Enter a name & password ‚Äî you won't see this again on this browser.</p>
    <div style="margin-top:12px;text-align:left">
      <label class="small">Name</label>
      <input id="loginName" style="width:100%;padding:10px;border-radius:8px;border:1px solid #e6eefc" placeholder="Your display name" />
      <label class="small" style="margin-top:8px">Password</label>
      <input id="loginPass" type="password" style="width:100%;padding:10px;border-radius:8px;border:1px solid #e6eefc" placeholder="Choose a password" />
      <div style="text-align:right;margin-top:10px">
        <button class="btn" onclick="doLogin()">Sign In</button>
      </div>
      <div class="small" style="margin-top:8px;color:#bcd9ff">This is a simple local sign-in ‚Äî used for showing your FC while challenging.</div>
    </div>
  </div>
</div>

<!-- Top bar -->
<header>
  <div class="brand">
    <div class="logo">SV</div>
    <div><h1>Sky VS</h1></div>
  </div>
  <div class="top-actions">
    <button id="profileBtn" class="profileBtn" title="Profile" onclick="openProfile()"><span class="dot"></span><span id="profileName">Profile</span></button>
  </div>
</header>

<!-- Main Dashboard -->
<div id="mainWrap">
  <div id="dashboard">
    <h2 class="pageTitle">üéÆ Sky VS Dashboard</h2>
    <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:14px">
      <div style="color:var(--muted)">Players online ‚Äî click a card to view / invite / VS</div>
      <div>
        <button class="btn" onclick="document.getElementById('addMyForm').scrollIntoView({behavior:'smooth'})">‚ûï Add Your Player</button>
      </div>
    </div>

    <!-- player list -->
    <div class="players" id="playersContainer">
      <!-- dynamically injected -->
    </div>

    <!-- Add My Player Form -->
    <div id="addMyForm" style="margin-top:26px;max-width:560px">
      <div style="background:#f7fbff;padding:14px;border-radius:12px;border:1px solid #eef7ff">
        <h3 style="margin:0 0 8px">‚ûï Add My VS (Upload)</h3>
        <div style="display:flex;gap:10px;flex-wrap:wrap">
          <input id="myName" placeholder="Name" style="flex:1;padding:10px;border-radius:8px;border:1px solid #e6eefc" />
          <input id="myFc" placeholder="FC_ID" style="flex:1;padding:10px;border-radius:8px;border:1px solid #e6eefc" />
          <input id="myEmail" placeholder="Email (optional)" style="flex:1;padding:10px;border-radius:8px;border:1px solid #e6eefc" />
        </div>
        <div style="margin-top:10px;text-align:right">
          <button class="btn" onclick="uploadMyPlayer()">Upload</button>
        </div>
        <div id="uploadStatus" class="small" style="margin-top:8px;color:var(--muted)"></div>
      </div>
    </div>
  </div>
</div>

<!-- Profile Modal -->
<div id="profileModal" class="modal" style="display:none">
  <div class="card">
    <h3 id="pmTitle">Profile</h3>
    <div class="field">
      <label class="small">Signed in as</label>
      <div id="pmName" style="font-weight:700"></div>
    </div>
    <div class="field">
      <label class="small">Your saved FC_ID</label>
      <input id="pmFC" placeholder="Enter your FC ID to store locally" />
    </div>
    <div class="field">
      <label class="small">Your email (optional)</label>
      <input id="pmEmail" placeholder="email@example.com" />
    </div>
    <div style="display:flex;gap:8px;justify-content:flex-end;margin-top:10px">
      <button class="btn" onclick="saveProfile()">Save</button>
      <button onclick="closeProfile()" style="background:#fff;border:1px solid #eee;padding:8px 12px;border-radius:8px;cursor:pointer">Close</button>
    </div>
    <div style="margin-top:10px;text-align:left">
      <button style="background:#fff;border:1px solid #f66;color:#f66;padding:8px 12px;border-radius:8px;cursor:pointer" onclick="logout()">Logout</button>
    </div>
  </div>
</div>

<!-- Player Modal -->
<div id="playerModal" class="modal" style="display:none">
  <div class="card" id="playerCardInner">
    <h3 id="pmPlayerTitle">Player</h3>
    <div class="small" id="pmPlayerFc">FC ID: ‚Äî</div>
    <div class="small" id="pmPlayerEmail">Email: ‚Äî</div>
    <div style="margin-top:12px;display:flex;gap:8px;justify-content:flex-end">
      <button class="btn" onclick="invitePlayer()">Invite</button>
      <button onclick="vsPlayerPrompt()" style="background:#fff;border:1px solid #eee;padding:8px 12px;border-radius:8px;cursor:pointer">VS this player</button>
    </div>
    <div style="margin-top:10px;text-align:left">
      <button onclick="closePlayerModal()" style="background:#fff;border:1px solid #eee;padding:8px 12px;border-radius:8px;cursor:pointer">Close</button>
    </div>
  </div>
</div>

<!-- toast -->
<div id="toast"></div>

<script>
/* ================= SETTINGS ================= */
const SHEET_API = "https://sheetdb.io/api/v1/cnaot5a2ege6d"; // <- your SheetDB API (already provided)

/* ================ UTILITIES ================= */
function showToast(txt, timeout=3000){
  const t = document.getElementById('toast');
  t.innerText = txt; t.style.display='block';
  setTimeout(()=>{ t.style.display='none'; }, timeout);
}

/* =============== LOGIN LOGIC ================ */
function isSignedIn(){ return !!localStorage.getItem('skyvs_user'); }
function doLogin(){
  const name = document.getElementById('loginName').value.trim();
  const pass = document.getElementById('loginPass').value.trim();
  if(!name || !pass){ alert('Enter name and password'); return; }
  // simple local auth - store hashed-ish token (not secure but okay for fun)
  localStorage.setItem('skyvs_user', name);
  localStorage.setItem('skyvs_token', btoa(name+':'+pass));
  // optional stored profile fields
  if(!localStorage.getItem('skyvs_fc')) localStorage.setItem('skyvs_fc','');
  if(!localStorage.getItem('skyvs_email')) localStorage.setItem('skyvs_email','');
  document.getElementById('loginScreen').style.display='none';
  initAfterLogin();
}

/* logout */
function logout(){
  if(confirm('Logout & remove local profile?')) {
    localStorage.removeItem('skyvs_user');
    localStorage.removeItem('skyvs_token');
    localStorage.removeItem('skyvs_fc');
    localStorage.removeItem('skyvs_email');
    location.reload();
  }
}

/* set profile modal values */
function openProfile(){
  const user = localStorage.getItem('skyvs_user') || 'Guest';
  document.getElementById('pmTitle').innerText = 'Profile';
  document.getElementById('pmName').innerText = user;
  document.getElementById('profileModal').style.display='flex';
  document.getElementById('pmFC').value = localStorage.getItem('skyvs_fc') || '';
  document.getElementById('pmEmail').value = localStorage.getItem('skyvs_email') || '';
  document.getElementById('profileName').innerText = user;
}
function closeProfile(){ document.getElementById('profileModal').style.display='none'; }
function saveProfile(){
  const fc = document.getElementById('pmFC').value.trim();
  const email = document.getElementById('pmEmail').value.trim();
  localStorage.setItem('skyvs_fc', fc);
  localStorage.setItem('skyvs_email', email);
  showToast('Profile saved locally');
  closeProfile();
}

/* ============== LOADING / FLOW ============== */
function goToInfo(){
  document.getElementById('warningScreen').style.display='none';
  document.getElementById('infoScreen').style.display='block';
}
function openDashboard(){
  document.getElementById('infoScreen').style.display='none';
  // show login if not signed in
  if(!isSignedIn()){
    document.getElementById('loginScreen').style.display='flex';
  } else {
    initAfterLogin();
  }
}

/* hide loading after animation, then show warning */
window.addEventListener('load', ()=>{
  // ensure loading finishes before showing warning (mimic real load)
  setTimeout(()=>{
    document.getElementById('loadingScreen').style.display='none';
    document.getElementById('warningScreen').style.display='block';
  }, 1600);
});

/* initialize after login */
function initAfterLogin(){
  document.getElementById('loginScreen').style.display='none';
  document.getElementById('dashboard').style.display='block';
  document.getElementById('profileName').innerText = localStorage.getItem('skyvs_user') || 'Profile';
  loadPlayers();
}

/* =============== PLAYER LOADING ================ */
async function loadPlayers(){
  const container = document.getElementById('playersContainer');
  container.innerHTML = '<div style="color:#999">Loading players...</div>';
  try{
    const res = await fetch(SHEET_API);
    if(!res.ok) throw new Error('Fetch error '+res.status);
    const data = await res.json();
    // data is array of objects
    container.innerHTML = '';
    if(!data.length){ container.innerHTML = '<div style="color:#999">No players yet. Add your player!</div>'; return; }
    data.forEach(item=>{
      const name = item.Name || 'Unnamed';
      const fc = item.FC_ID || '';
      const email = item.Email || '';
      const card = document.createElement('div');
      card.className = 'player-card';
      card.innerHTML = `<div class="player-name">${escapeHtml(name)}</div>
                        <div class="player-sub">${escapeHtml(fc)}</div>
                        <div class="player-meta">${email ? escapeHtml(email) : ''}</div>`;
      card.onclick = ()=>openPlayerModal(name,fc,email);
      container.appendChild(card);
    });
  }catch(e){
    container.innerHTML = '<div style="color:#f44">Failed to load players. Check API & CORS.</div>';
    console.error(e);
  }
}

/* ============ ADD / UPLOAD PLAYER ============== */
async function uploadMyPlayer(){
  const name = document.getElementById('myName').value.trim();
  const fc = document.getElementById('myFc').value.trim();
  const email = document.getElementById('myEmail').value.trim();
  const status = document.getElementById('uploadStatus');
  if(!name || !fc){ status.innerText = 'Name and FC_ID are required'; return; }
  status.innerText = 'Uploading...';
  try{
    const body = { data: [ { Name: name, FC_ID: fc, Email: email } ] };
    const res = await fetch(SHEET_API, { method:'POST', headers:{'Content-Type':'application/json'}, body: JSON.stringify(body) });
    const json = await res.json();
    if(res.ok){
      status.innerText = 'Uploaded ‚úì';
      document.getElementById('myName').value=''; document.getElementById('myFc').value=''; document.getElementById('myEmail').value='';
      showToast('Player uploaded to sheet');
      loadPlayers();
    } else {
      status.innerText = 'Upload failed';
      console.error('Upload error', json);
      showToast('Upload failed: '+(json.error||'server'));
    }
  }catch(err){
    status.innerText = 'Upload failed';
    console.error(err);
    showToast('Upload failed (network)');
  }
}

/* ============= PLAYER MODAL ACTIONS ============= */
let currentTarget = {name:'',fc:'',email:''};
function openPlayerModal(name, fc, email){
  currentTarget = {name,fc,email};
  document.getElementById('playerModal').style.display='flex';
  document.getElementById('pmPlayerTitle').innerText = name;
  document.getElementById('pmPlayerFc').innerText = 'FC ID: ' + (fc||'‚Äî');
  document.getElementById('pmPlayerEmail').innerText = 'Email: ' + (email||'‚Äî');
}
function closePlayerModal(){ document.getElementById('playerModal').style.display='none'; }

/* Invite (simple copy to clipboard of email or show msg) */
function invitePlayer(){
  const email = currentTarget.email || '';
  if(email){
    navigator.clipboard?.writeText(email).then(()=> showToast('Player email copied to clipboard') ).catch(()=> alert('Email: '+email));
  } else {
    alert('No email available for this player.');
  }
}

/* VS flow: prompt for your FC ID, then POST a "challenge" entry to sheet */
async function vsPlayerPrompt(){
  // ensure signed in
  if(!isSignedIn()){ alert('Sign in required'); return; }
  const userFc = localStorage.getItem('skyvs_fc') || '';
  const preset = userFc || '';
  const input = prompt(`Enter YOUR FC ID to VS ${currentTarget.name}:`, preset);
  if(!input) return;
  // record challenge to sheet as a new row so you can see who challenged whom
  try{
    const payload = { data: [ { Name: currentTarget.name, FC_ID: input, Email: currentTarget.email || '', Action: 'vs' } ] };
    const res = await fetch(SHEET_API, { method:'POST', headers:{'Content-Type':'application/json'}, body: JSON.stringify(payload) });
    const resj = await res.json();
    if(res.ok){
      showToast('Challenge recorded ‚úì');
      closePlayerModal();
      loadPlayers(); // optional: refresh
    } else {
      console.error('vs post error', resj);
      alert('Could not record challenge. Check API settings.');
    }
  }catch(e){
    console.error(e);
    alert('Network error recording challenge.');
  }
}

/* ======= small helpers ======= */
function escapeHtml(s){ if(!s) return ''; return String(s).replace(/[&<>"']/g, c=>({ '&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;' })[c]); }

/* show login if not signed in when opening page after the info screen */
(function init(){
  // create decorative bubbles
  const bubbles = document.createElement('div'); bubbles.className='bubbles';
  const sizes=[80,140,60,110,90];
  sizes.forEach((sz,i)=>{
    const b = document.createElement('div'); b.className='bubble';
    b.style.width=sz+'px'; b.style.height=sz+'px';
    b.style.left=(10+20*i)+'%'; b.style.bottom='-'+(50+30*i)+'px';
    b.style.animation=`rise${i} ${12+4*i}s linear infinite`;
    b.style.opacity= (i%2?'.65':'.45');
    bubbles.appendChild(b);
    // add keyframes dynamically (unique name)
    const k = `@keyframes rise${i}{0%{transform:translateY(0) scale(.9)}100%{transform:translateY(-120vh) scale(1.15)}}`;
    const st = document.createElement('style'); st.innerHTML = k; document.head.appendChild(st);
  });
  document.body.appendChild(bubbles);

  // show login if already signed in? We keep showing login only if user not signed in and info screen closed.
  if(isSignedIn()){
    // hide login screen permanently
    document.getElementById('loginScreen').style.display='none';
    // but dashboard only appears after you click through the warning/info (handled in openDashboard)
  } else {
    // ensure profile name placeholder
    document.getElementById('profileName').innerText = 'Profile';
  }
})();
</script>
</body>
</html>

